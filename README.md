# Какой смысл и задача у алгоритма - "активность пользователя в течение дня"?

Мы пытаемся понять, как часто пользователь встает со стула\дивана\кровати.

С точки зрения здоровья важно, чтобы человек имел не только достаточное количество физических упражнений, 
но и не залипал слишком долго сидя на одном месте за компьютером или сериалом.

Лучше двигаться в течение всего дня понемногу, чем иметь одну пробежку после или до 23 часов сидения на диване.

Для этого вводятся понятия:

**Balance Points** - условные баллы, которые пользователь получает, если осуществляет эпизоды непрерывной ходьбы в рамках астрономических часов.

**Balance Day** - показатель, который отражает распределение активности пользователя в течение дня, 

где 0% - это **плохо удается**, 

а 100% - **отлично удается** двигаться в течении дня. (Можно даже перевыполнить дневную цель и набрать больше 100%.)

Формула для расчета: **Balance Day** = 100% * **balance_points** / 10 

(*Упрощенная формула для расчета: **Balance Day** = **balance_points** * 10*)

Нужно создать алгортим обработки данных от Apple Watch о шагах (выгруженной в формате файла CSV)

## Вводные и тестовые данные

Есть CSV файл, в котором данные из Apple Health и других источников (данные могут быть за несколько дней, они могут быть не отсортированы по дате или иметь дубликаты)

Основные поля для анализа:

1. **sourceName** - источник данных (нас интересует только источник - **Users’s Apple Watch**)
1. **startDate** - начало интервала, когда у пользователя была ходьба, эпизод ходьбы
1. **endDate** - конец интервала, когда у пользователя была ходьба
1. **value** - количество шагов, которые прошел пользователь за указанный интервал времени (*не анализируем, так как нас интересует не интенсивность ходьбы, а активность в течении дня*)

Перед началом анализа данных, нормализуем их:

1. Требуется отсеять данные не из источника - **Users’s Apple Watch**
1. Требуется сортировка данных по дате в порядке возрастания (в хронологическом порядке, чтобы правильно определить эпизоды активности на стыке астро. часов или астро. суток). 
1. Требуется отсеять дубликаты данных, если эпизод ходьбы был залогирован больше одного раза, его нужно обработать единожды

## Методика расчётов

Чтобы рассчитать **balance points**, необходимо:

1. Склеить и определить все записи о непрерывной ходьбе в эпизоды активности (**Непрерывная ходьба - это записи ходьбы, которые идут подряд и между которыми не было остановок свыше 18 сек и общая длительность цельного или составного эпизода активности больше или равна 180 сек**)
1. Найти все астрономические часы в которые входят эпизоды активности
1. Расcчитать по условиям **balance points** для каждого из этих астро. часов

### Условия расчёта **balance points**

 - Если в течение астрономического часа условие непрерывной ходьбы выполняется один раз, начисляется 1 balance point 
 - Если в течение астрономического часа находится более одного эпизода непрерывной ходьбы, то определяется промежуток времени между началом первого такого эпизода и началом последнего такого эпизода в течение одного астрономического часа, и если промежуток больше или равен 2280 сек (38 минут), то за такой час начисляется 2 balance point
 
 > Чтобы рассчитать balance points, необходимо найти все астрономические часы (например, с часу до двух ( [13:00:00 - 13:59:59] ), с двух до трех ([14:00:00 - 14:59:59]) и т.д.) 
 
 > Например, кейс:  startDate =  '2021-02-16 08:58:12' endDate =  '2021-02-16 09:01:58' не подходит,
 
 > И кейс: startDate =  '2021-02-16 10:57:52',  endDate = '2021-02-16 11:11:15' будет засчитан только для 11 часов. То есть для 10ти часов не засчитаем, а для 11 засчитаем.
 
 > А при таких данных:
  startDate = ‘2020-03-20 07:50:05’ endDate = ‘2020-03-20 07:51:04’
  startDate = ‘2020-03-20 07:51:15’ endDate = ‘2020-03-20 07:59:04’ будет засчитан для 07 часов.

Чтобы рассчитать **balance day**, необходимо:

1. Для расчёта Balance Day за день суммируются все balance points асто. часов этого дня 
1. Если за день пользователь набрал 10 balance points, то Balance Day = 100%, т.е. 1 balance point = 10%.

## Технические требования к задаче

1. Спарсить данные из CSV файла.
1. Разбить их по дням и для каждого посчитать balance points и balance day по алгоритму выше.
1. Сформировать и выгрузить результат в CSV файл

## Что важно понимать и сделать

1. Требуются замеры производительности скрипта и версионность, чтобы понимать как оптимизировать работу алгоритма в необходимых условиях
1. Для улучшения производительности стоит обрабатывать данные порциями по одной календарной дате (астро. день), с корректным определением эпизодов активности на стыках астро. суток
1. Необходима документация методов скрипта для поддерживаемости кода
1. Необходимо авто-тестирование (**Unit tests**) методов скрипта при инициализации, для возможности декомпозиции решения

#### Вопросы к заданию

1. Для округления до целых чисел Balance day, требуется чтобы balance points могли быть дробными, нужны доп условия или коэффициент для расчетов при которых баллы могут дробиться

#### Пример результирующего файла в csv формате
>  day,balance_points,balance_day<br>
> 2020-03-17,10,100.0<br>
> 2020-03-18,5,50.0<br>
> 2020-03-19,12,120.0<br>
> 2020-03-20,7,70.0<br>
